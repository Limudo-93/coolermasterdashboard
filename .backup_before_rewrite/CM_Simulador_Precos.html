<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CM Brasil ‚Äî Simulador de Pre√ßos</title>
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HUB DESIGN SYSTEM ‚Äî CM Brasil Intelligence
   Applied by apply_hub_design.py
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* Override root variables with Hub tokens */
:root {
  --bg:           #09090b !important;
  --bg-primary:   #09090b !important;
  --bg-secondary: #18181b !important;
  --bg-card:      #18181b !important;
  --bg2:          #18181b !important;
  --bg3:          #1c1c1f !important;
  --surface:      #18181b;
  --surface2:     #1c1c1f;
  --border:       #27272a;
  --border-hover: #3f3f46;
  --text:         #fafafa;
  --text-primary: #fafafa !important;
  --text-2:       #a1a1aa;
  --text-secondary:#a1a1aa !important;
  --text-3:       #71717a;
  --text-muted:   #71717a !important;
  --accent:       #7c3aed;
  --accent-2:     #6d28d9;
  --accent-glow:  rgba(124, 58, 237, 0.12);
  --blue:         #3b82f6;
  --blue-glow:    rgba(59, 130, 246, 0.10);
  --green:        #22c55e;
  --green-dim:    rgba(34, 197, 94, 0.15);
  --yellow:       #eab308;
  --yellow-dim:   rgba(234, 179, 8, 0.15);
  --red:          #ef4444;
  --red-dim:      rgba(239, 68, 68, 0.15);
  --purple-dim:   rgba(124, 58, 237, 0.15);
  --cm-blue:      #7c3aed !important;

  /* Alias overrides for older var names */
  --green-start:  #22c55e !important;
  --blue-start:   #3b82f6 !important;
}

/* Base body */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI',
               Helvetica, Arial, sans-serif !important;
  background: #09090b !important;
  color: #fafafa !important;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Custom scrollbar */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #27272a; border-radius: 99px; }
::-webkit-scrollbar-thumb:hover { background: #3f3f46; }

/* ‚îÄ‚îÄ Hub Top Nav ‚îÄ‚îÄ */
.hub-nav {
  background: #09090b;
  border-bottom: 1px solid #27272a;
  padding: 0 32px;
  height: 52px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 9999;
  flex-shrink: 0;
}
.hub-nav-brand { display: flex; align-items: center; gap: 14px; }
.hub-nav-back {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 11px;
  color: #71717a;
  text-decoration: none;
  border: 1px solid #27272a;
  border-radius: 6px;
  padding: 4px 10px;
  transition: color 0.15s, border-color 0.15s;
  white-space: nowrap;
}
.hub-nav-back:hover { color: #fafafa; border-color: #3f3f46; }
.hub-nav-sep { width: 1px; height: 26px; background: #27272a; flex-shrink: 0; }
.hub-nav-info {}
.hub-nav-title {
  font-size: 14px;
  font-weight: 650;
  color: #fafafa;
  letter-spacing: -0.25px;
  line-height: 1.2;
}
.hub-nav-sub {
  font-size: 10.5px;
  color: #71717a;
  display: flex;
  align-items: center;
  gap: 5px;
  margin-top: 1px;
}
.hub-nav-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: #22c55e;
  box-shadow: 0 0 0 2px rgba(34,197,94,0.2);
  animation: hubnav-pulse 2.5s ease-in-out infinite;
  flex-shrink: 0;
}
@keyframes hubnav-pulse { 0%,100%{opacity:1} 50%{opacity:0.45} }
.hub-nav-clock {
  font-size: 13px;
  font-variant-numeric: tabular-nums;
  color: #71717a;
  font-family: 'Menlo','SF Mono','Consolas',monospace;
  flex-shrink: 0;
}

/* ‚îÄ‚îÄ Hub Footer ‚îÄ‚îÄ */
.hub-footer {
  border-top: 1px solid #27272a;
  padding: 20px 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 48px;
  font-size: 11.5px;
  color: #52525b;
}
.hub-footer a {
  color: #71717a;
  text-decoration: none;
  transition: color 0.15s;
}
.hub-footer a:hover { color: #fafafa; }


  :root {
    --bg-primary: #0d1117;
    --bg-secondary: #161b22;
    --bg-card: #21262d;
    --border: #30363d;
    --text-primary: #e6edf3;
    --text-secondary: #8b949e;
    --text-muted: #656d76;
    --green: #3fb950;
    --blue: #58a6ff;
    --yellow: #d29922;
    --red: #f85149;
    --purple: #bc8cff;
    --orange: #f0883e;
    --cyan: #39c5cf;
    --green-dim: rgba(63,185,80,0.12);
    --blue-dim: rgba(88,166,255,0.12);
    --yellow-dim: rgba(210,153,34,0.12);
    --red-dim: rgba(248,81,73,0.12);
    --purple-dim: rgba(188,140,255,0.12);
    --orange-dim: rgba(240,136,62,0.12);
    --cyan-dim: rgba(57,197,207,0.12);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
    font-size: 14px;
    line-height: 1.5;
    min-height: 100vh;
  }

  .header {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border);
    padding: 16px 24px 0;
    position: sticky; top: 0; z-index: 100;
  }
  .header-top { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
  .header-logo {
    width: 32px; height: 32px;
    background: linear-gradient(135deg, #f0883e, #d29922);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; font-weight: 900; color: #0d1117;
  }
  .header-title { font-size: 18px; font-weight: 700; }
  .header-sub { font-size: 12px; color: var(--text-secondary); margin-top: 1px; }
  .header-badges { margin-left: auto; display: flex; gap: 8px; align-items: center; }
  .badge { padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
  .badge-orange { background: var(--orange-dim); border: 1px solid var(--orange); color: var(--orange); }
  .badge-blue   { background: var(--blue-dim);   border: 1px solid var(--blue);   color: var(--blue);   }
  .badge-green  { background: var(--green-dim);  border: 1px solid var(--green);  color: var(--green);  }
  .tabs { display: flex; gap: 2px; overflow-x: auto; scrollbar-width: none; }
  .tabs::-webkit-scrollbar { display: none; }
  .tab-btn {
    padding: 10px 18px;
    background: none; border: none;
    color: var(--text-secondary);
    cursor: pointer; font-size: 13px; font-weight: 500;
    border-bottom: 2px solid transparent; white-space: nowrap;
    transition: color 0.15s, border-color 0.15s;
  }
  .tab-btn:hover { color: var(--text-primary); }
  .tab-btn.active { color: var(--orange); border-bottom-color: var(--orange); }

  .main { padding: 20px 24px; max-width: 1400px; margin: 0 auto; }
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  .grid-2 { display: grid; grid-template-columns: 390px 1fr; gap: 16px; align-items: start; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; align-items: start; }
  @media (max-width: 900px) {
    .grid-2 { grid-template-columns: 1fr; }
    .grid-3 { grid-template-columns: 1fr; }
  }

  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
  }
  .card-title {
    font-size: 13px; font-weight: 600; color: var(--text-secondary);
    text-transform: uppercase; letter-spacing: 0.5px;
    margin-bottom: 14px;
    display: flex; align-items: center; gap: 8px;
  }
  .card-title .dot { width: 8px; height: 8px; border-radius: 50%; }

  .field { margin-bottom: 12px; }
  .field label { display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 500; }
  .field .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
  .field .label-row label { margin-bottom: 0; }
  .field .label-row .val-display { font-size: 12px; font-weight: 700; color: var(--text-primary); min-width: 50px; text-align: right; }
  input[type="number"], input[type="text"], select {
    width: 100%;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-primary);
    padding: 8px 10px;
    font-size: 13px;
    outline: none;
    transition: border-color 0.15s;
  }
  input[type="number"]:focus, input[type="text"]:focus, select:focus { border-color: var(--blue); }
  input[type="range"] { width: 100%; accent-color: var(--orange); cursor: pointer; }
  select option { background: var(--bg-card); }

  .section-header {
    display: flex; align-items: center; gap: 8px;
    margin-bottom: 8px; margin-top: 4px;
    font-size: 11px; font-weight: 600;
    color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px;
  }
  .section-header::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  .breakdown { display: flex; flex-direction: column; gap: 3px; margin-top: 4px; }
  .bline {
    display: flex; justify-content: space-between; align-items: center;
    padding: 6px 10px; border-radius: 6px; font-size: 13px;
  }
  .bline:hover { background: rgba(255,255,255,0.03); }
  .bline .blabel { color: var(--text-secondary); display: flex; align-items: center; gap: 6px; }
  .bline .bval { font-weight: 600; font-variant-numeric: tabular-nums; min-width: 90px; text-align: right; }
  .bline.subtotal { background: var(--bg-secondary); margin: 4px 0; }
  .bline.subtotal .blabel { color: var(--text-primary); font-weight: 600; }
  .bline.total {
    background: linear-gradient(90deg, rgba(240,136,62,0.15), rgba(210,153,34,0.08));
    border: 1px solid rgba(240,136,62,0.4);
    margin-top: 8px;
  }
  .bline.total .blabel { color: var(--orange); font-weight: 700; font-size: 14px; }
  .bline.total .bval  { color: var(--orange); font-size: 14px; }
  .bline.margin-line { background: var(--green-dim); }
  .bline.margin-line .blabel { color: var(--green); font-weight: 600; }
  .bline.margin-line .bval { color: var(--green); }
  .bline.tax-line .bval   { color: var(--red); }
  .bline.tax-line .blabel { color: var(--text-secondary); }
  .bline.fob-line { background: var(--blue-dim); }
  .bline.fob-line .blabel { color: var(--blue); font-weight: 600; }
  .bline.fob-line .bval   { color: var(--blue); }
  .bline.zero-tax .bval   { color: var(--green); }
  .bline.zero-tax .blabel { color: var(--text-muted); }

  .pill {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 2px 8px; border-radius: 20px;
    font-size: 11px; font-weight: 600;
  }
  .pill-red    { background: var(--red-dim);    color: var(--red);    border: 1px solid var(--red); }
  .pill-green  { background: var(--green-dim);  color: var(--green);  border: 1px solid var(--green); }
  .pill-blue   { background: var(--blue-dim);   color: var(--blue);   border: 1px solid var(--blue); }
  .pill-orange { background: var(--orange-dim); color: var(--orange); border: 1px solid var(--orange); }
  .pill-purple { background: var(--purple-dim); color: var(--purple); border: 1px solid var(--purple); }

  .metric-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 16px; }
  .metric {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px; padding: 12px; text-align: center;
  }
  .metric .mval { font-size: 20px; font-weight: 800; font-variant-numeric: tabular-nums; line-height: 1.2; }
  .metric .mlabel { font-size: 11px; color: var(--text-muted); margin-top: 3px; }

  .waterfall { margin-top: 8px; }
  .wf-bar-row { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
  .wf-label { font-size: 11px; color: var(--text-secondary); width: 110px; text-align: right; flex-shrink: 0; }
  .wf-bar-wrap { flex: 1; height: 20px; background: rgba(255,255,255,0.04); border-radius: 4px; overflow: hidden; position: relative; }
  .wf-bar { height: 100%; border-radius: 4px; transition: width 0.4s ease; }
  .wf-barval { position: absolute; right: 6px; top: 50%; transform: translateY(-50%); font-size: 10px; font-weight: 600; color: #fff; white-space: nowrap; }

  .result-hero {
    background: linear-gradient(135deg, rgba(240,136,62,0.1), rgba(210,153,34,0.05));
    border: 1px solid rgba(240,136,62,0.3);
    border-radius: 12px; padding: 20px;
    text-align: center; margin-bottom: 16px;
  }
  .result-hero .hero-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
  .result-hero .hero-val   { font-size: 36px; font-weight: 900; color: var(--orange); margin: 4px 0; }
  .result-hero .hero-sub   { font-size: 13px; color: var(--text-secondary); }

  .comp-col { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 16px; }
  .comp-col.highlight { border-color: var(--blue); }
  .comp-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
  .comp-header input { flex: 1; font-size: 14px; font-weight: 700; background: transparent; border: none; border-bottom: 1px solid var(--border); color: var(--text-primary); padding: 4px 0; outline: none; }
  .comp-header input:focus { border-bottom-color: var(--blue); }

  .diff-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.04); }
  .diff-row:last-child { border: none; }
  .diff-row .dl { font-size: 12px; color: var(--text-secondary); }
  .diff-row .dv { font-size: 12px; font-weight: 700; }
  .dv.positive { color: var(--green); }
  .dv.negative { color: var(--red); }
  .dv.neutral  { color: var(--text-secondary); }

  .note {
    background: var(--yellow-dim);
    border: 1px solid rgba(210,153,34,0.4);
    border-radius: 8px; padding: 10px 14px;
    font-size: 12px; color: var(--yellow);
    margin-top: 12px; line-height: 1.6;
  }
  .note strong { font-weight: 700; }
  .note-green  { background: var(--green-dim);  border-color: rgba(63,185,80,0.4);   color: var(--green); }
  .note-blue   { background: var(--blue-dim);   border-color: rgba(88,166,255,0.4);  color: var(--blue); }
  .note-purple { background: var(--purple-dim); border-color: rgba(188,140,255,0.4); color: var(--purple); }
  .note-red    { background: var(--red-dim);    border-color: rgba(248,81,73,0.4);   color: var(--red); }

  .divider { height: 1px; background: var(--border); margin: 12px 0; }
  .btn {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 8px 16px; border-radius: 6px;
    font-size: 13px; font-weight: 600; cursor: pointer;
    border: none; transition: opacity 0.15s;
  }
  .btn:hover { opacity: 0.85; }
  .btn-orange { background: var(--orange); color: #0d1117; }
  .btn-ghost  { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); }
  .btn-row    { display: flex; gap: 8px; margin-top: 12px; }

  .toggle-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.04);
  }
  .toggle-row:last-child { border: none; }
  .toggle-label { font-size: 12px; color: var(--text-secondary); }

  .acc-title {
    cursor: pointer; display: flex; justify-content: space-between;
    align-items: center; padding: 8px 0; user-select: none;
    font-size: 12px; font-weight: 600; color: var(--text-muted);
    text-transform: uppercase; letter-spacing: 0.4px;
  }
  .acc-title::after { content: '‚ñ∏'; transition: transform 0.2s; font-size: 10px; }
  .acc-title.open::after { transform: rotate(90deg); }
  .acc-body { display: none; }
  .acc-body.open { display: block; }

  .info-icon { color: var(--text-muted); cursor: help; font-size: 11px; }
  .ncm-badge {
    font-size: 10px; padding: 1px 6px;
    background: var(--purple-dim); color: var(--purple);
    border: 1px solid rgba(188,140,255,0.4);
    border-radius: 4px; font-family: monospace;
  }
  .regime-badge {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 6px 10px; border-radius: 6px;
    font-size: 11px; line-height: 1.5;
    margin-top: 8px; width: 100%;
  }
  .regime-tag {
    font-size: 10px; padding: 1px 7px; border-radius: 20px;
    font-weight: 800; white-space: nowrap;
  }

  /* Validated badge */
  .validated-badge {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 3px 10px; border-radius: 20px;
    background: var(--green-dim); border: 1px solid var(--green);
    color: var(--green); font-size: 10px; font-weight: 700;
  }

/* Hide original header ‚Äî replaced by Hub nav */
.header:not(.hub-nav) { display: none !important; }
header:not(.hub-nav) { display: none !important; }
#header { display: none !important; }
.topbar:not(.hub-nav) { display: none !important; }
.navbar:not(.hub-nav) { display: none !important; }
.top-bar:not(.hub-nav) { display: none !important; }

</style>
</head>
<body>
<!-- ‚ïê‚ïê HUB NAV ‚ïê‚ïê -->
<nav class="hub-nav" id="hub-nav">
  <div class="hub-nav-brand">
    <a href="CM_Brasil_Hub.html" class="hub-nav-back">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
      Hub
    </a>
    <div class="hub-nav-sep"></div>
    <div class="hub-nav-info">
      <div class="hub-nav-title">Simulador de Pre√ßos</div>
      <div class="hub-nav-sub"><span class="hub-nav-dot"></span>Cooler Master Brasil</div>
    </div>
  </div>
  <div class="hub-nav-clock" id="hub-nav-clock">--:--:--</div>
</nav>
<script>
(function(){
  function _hubtick(){
    var el=document.getElementById("hub-nav-clock");
    if(el) el.textContent=new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});
  }
  _hubtick(); setInterval(_hubtick,1000);
})();
</script>
<!-- ‚ïê‚ïê END HUB NAV ‚ïê‚ïê -->


<!-- HEADER -->
<div class="header">
  <div class="header-top">
    <div class="header-logo">CM</div>
    <div>
      <div class="header-title">Simulador de Pre√ßos CM Brasil</div>
      <div class="header-sub">Calculadora de importa√ß√£o e forma√ß√£o de pre√ßo varejo ‚Äî FOB = pre√ßo de venda CM (margem j√° inclusa)</div>
    </div>
    <div class="header-badges">
      <span class="badge badge-blue" id="badge-cambio">USD/BRL 5.2458</span>
      <span class="badge badge-green">‚úÖ Validado: $9 FOB ‚Üí R$78 KaBuM</span>
      <span class="badge badge-orange">v2.0 ‚Äî Fev 2026</span>
    </div>
  </div>
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('forward',this)">üöÄ Forward (FOB ‚Üí Varejo)</button>
    <button class="tab-btn" onclick="switchTab('reverse',this)">üîç Reverse (Varejo ‚Üí FOB)</button>
    <button class="tab-btn" onclick="switchTab('comparador',this)">‚öñÔ∏è Comparador</button>
    <button class="tab-btn" onclick="switchTab('ajustes',this)">‚öôÔ∏è Al√≠quotas &amp; Config</button>
  </div>
</div>

<div class="main">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 1: FORWARD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-forward" class="tab-panel active">
  <div class="grid-2">

    <!-- LEFT: INPUTS -->
    <div>
      <!-- Card: Produto & Origem -->
      <div class="card" style="margin-bottom:12px">
        <div class="card-title"><span class="dot" style="background:var(--blue)"></span>Produto &amp; Origem</div>

        <div class="field">
          <label>Categoria do Produto</label>
          <select id="f-categoria" onchange="onCategoryChange('f');calcForward()">
            <option value="cooler">Coolers / Heatsinks (Hyper 212, etc.)</option>
            <option value="psu">Fontes de Alimenta√ß√£o (PSU)</option>
            <option value="case">Gabinetes (Cases)</option>
            <option value="teclado">Teclados (Gamer / Mec√¢nicos)</option>
            <option value="mouse">Mouses</option>
            <option value="headset">Headsets / Fones</option>
          </select>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;">
          <span id="f-ncm-badge" class="ncm-badge">NCM 8414.59.90</span>
          <span id="f-ncm-desc" style="font-size:11px;color:var(--text-muted)">Ventiladores / Extratores</span>
        </div>

        <div class="field">
          <label>FOB Unit√°rio (USD) <span style="color:var(--orange);font-weight:700">= Pre√ßo de Venda CM ‚Üí Cliente</span></label>
          <input type="number" id="f-fob" value="9.00" step="0.01" min="0" oninput="calcForward()">
        </div>

        <div class="field">
          <div class="label-row">
            <label>C√¢mbio USD/BRL</label>
            <span class="val-display" id="f-cambio-disp">5.2458</span>
          </div>
          <input type="number" id="f-cambio" value="5.2458" step="0.01" min="1"
            oninput="document.getElementById('f-cambio-disp').textContent=parseFloat(this.value).toFixed(4);calcForward()">
        </div>

        <div class="field">
          <div class="label-row">
            <label>Frete Internacional (% do FOB)</label>
            <span class="val-display" id="f-frete-disp">12%</span>
          </div>
          <input type="range" id="f-frete" value="12" min="3" max="30" step="1"
            oninput="document.getElementById('f-frete-disp').textContent=this.value+'%';calcForward()">
        </div>

        <div class="field">
          <div class="label-row">
            <label>Seguro (% do FOB+Frete)</label>
            <span class="val-display" id="f-seguro-disp">0.5%</span>
          </div>
          <input type="range" id="f-seguro" value="0.5" min="0" max="2" step="0.1"
            oninput="document.getElementById('f-seguro-disp').textContent=this.value+'%';calcForward()">
        </div>
      </div>

      <!-- Card: Canal & Regime Fiscal -->
      <div class="card" style="margin-bottom:12px">
        <div class="card-title"><span class="dot" style="background:var(--orange)"></span>Canal &amp; Regime Fiscal</div>

        <div class="field">
          <label>Canal de Venda</label>
          <select id="f-canal" onchange="onCanalChange('f');calcForward()">
            <option value="direto">Direto (CM ‚Üí Varejista)</option>
            <option value="distrib">Via Distribui√ß√£o (CM ‚Üí Dist ‚Üí Varejista)</option>
          </select>
        </div>

        <div class="field">
          <label>Cliente / Estado</label>
          <select id="f-cliente" onchange="onClienteChange('f')">
            <option value="kabum">KaBuM ‚Äî ES (Esp√≠rito Santo)</option>
            <option value="terabyte">Terabyte ‚Äî SP (S√£o Paulo)</option>
            <option value="mazer">Mazer ‚Äî SC (Santa Catarina)</option>
            <option value="pichau">Pichau ‚Äî SC (Santa Catarina)</option>
            <option value="oderco">Oder√ßo ‚Äî SC (Santa Catarina)</option>
            <option value="vaip">VAIP ‚Äî SP (S√£o Paulo)</option>
            <option value="allnations">All Nations ‚Äî SP (S√£o Paulo)</option>
            <option value="custom">Personalizado...</option>
          </select>
        </div>

        <div class="field">
          <label>Regime Fiscal do Importador</label>
          <select id="f-regime" onchange="onRegimeChange('f');calcForward()">
            <option value="fundap">FUNDAP/ES ‚Äî II=0%, ICMS‚âà0% (KaBuM)</option>
            <option value="normal">Normal ‚Äî SP/RJ/MG ‚Äî II=tabela TIPI, ICMS=12%</option>
            <option value="ttd_sc">TTD/SC ‚Äî Santa Catarina ‚Äî II=tabela TIPI, ICMS‚âà4%</option>
            <option value="custom">Personalizado (definir manualmente)</option>
          </select>
        </div>

        <!-- Regime info badge -->
        <div id="f-regime-info" class="regime-badge note note-green" style="display:flex">
          <!-- auto-populated -->
        </div>

        <!-- ICMS: visible always, auto-set from regime (editable for custom) -->
        <div class="field" style="margin-top:10px">
          <div class="label-row">
            <label>ICMS Importa√ß√£o Efetivo (%)</label>
            <span class="val-display" id="f-icms-disp">0%</span>
          </div>
          <input type="range" id="f-icms" value="0" min="0" max="20" step="0.5"
            oninput="document.getElementById('f-icms-disp').textContent=parseFloat(this.value).toFixed(1)+'%';calcForward()">
        </div>

        <div class="field">
          <div class="label-row">
            <label>Despesas Aduaneiras &amp; Handling (% do CIF)</label>
            <span class="val-display" id="f-aduan-disp">4%</span>
          </div>
          <input type="range" id="f-aduan" value="4" min="1" max="10" step="0.5"
            oninput="document.getElementById('f-aduan-disp').textContent=this.value+'%';calcForward()">
        </div>
      </div>

      <!-- Card: Margens (retailer only, no CM margin) -->
      <div class="card">
        <div class="card-title"><span class="dot" style="background:var(--green)"></span>Margens do Canal</div>

        <div style="font-size:11px;color:var(--text-muted);background:var(--bg-secondary);border-radius:6px;padding:8px 10px;margin-bottom:12px;border-left:3px solid var(--orange)">
          <strong style="color:var(--orange)">FOB = Pre√ßo de venda CM</strong> ‚Äî a margem CM j√° est√° embutida no FOB.
          F√≥rmula varejista: <strong style="color:var(--text-primary)">Pre√ßo = Landed √ó (1 + Markup%)</strong>
          <br><span style="color:var(--text-muted)">Validado: $9 FOB ‚Üí R$61,51 landed √ó 1,27 = <strong style="color:var(--green)">R$78,12 ‚úÖ</strong></span>
        </div>

        <div id="f-dist-field" class="field" style="display:none">
          <div class="label-row">
            <label>Markup Distribuidor (%)</label>
            <span class="val-display" id="f-markup-dist-disp">18%</span>
          </div>
          <input type="range" id="f-markup-dist" value="18" min="5" max="50" step="1"
            oninput="document.getElementById('f-markup-dist-disp').textContent=this.value+'%';calcForward()">
        </div>

        <div class="field">
          <div class="label-row">
            <label>Markup Varejista (%) <span style="color:var(--text-muted);font-weight:400">= pre√ßo √∑ (1+m%) do KaBuM</span></label>
            <span class="val-display" id="f-markup-ret-disp">27%</span>
          </div>
          <input type="range" id="f-markup-ret" value="27" min="5" max="80" step="1"
            oninput="document.getElementById('f-markup-ret-disp').textContent=this.value+'%';calcForward()">
        </div>

        <div class="btn-row">
          <button class="btn btn-orange" onclick="calcForward()">‚ü≥ Recalcular</button>
          <button class="btn btn-ghost"  onclick="resetForward()">‚Ü∫ Reset</button>
        </div>
      </div>
    </div>

    <!-- RIGHT: RESULTS -->
    <div>
      <div class="result-hero">
        <div class="hero-label">Pre√ßo Final ao Consumidor</div>
        <div class="hero-val" id="f-result-hero">R$ ‚Äî</div>
        <div class="hero-sub" id="f-result-sub">Configure os par√¢metros e clique em Recalcular</div>
      </div>

      <div class="metric-row">
        <div class="metric">
          <div class="mval" id="f-met-fob" style="color:var(--blue)">‚Äî</div>
          <div class="mlabel">FOB (BRL)</div>
        </div>
        <div class="metric">
          <div class="mval" id="f-met-landed" style="color:var(--yellow)">‚Äî</div>
          <div class="mlabel">Landed Cost</div>
        </div>
        <div class="metric">
          <div class="mval" id="f-met-taxa" style="color:var(--red)">‚Äî</div>
          <div class="mlabel">Carga Trib. s/ Landed</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title"><span class="dot" style="background:var(--orange)"></span>Breakdown Completo</div>
        <div class="breakdown" id="f-breakdown">
          <div style="color:var(--text-muted);font-size:13px;padding:20px;text-align:center">
            Configure os par√¢metros e clique em Recalcular
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="card-title"><span class="dot" style="background:var(--purple)"></span>Composi√ß√£o do Pre√ßo</div>
        <div class="waterfall" id="f-waterfall"></div>
      </div>

      <div class="note" id="f-note" style="display:none"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 2: REVERSE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-reverse" class="tab-panel">
  <div class="grid-2">
    <!-- LEFT: INPUTS -->
    <div>
      <div class="card" style="margin-bottom:12px">
        <div class="card-title"><span class="dot" style="background:var(--cyan)"></span>Produto Alvo (Concorrente ou CM)</div>

        <div class="field">
          <label>Nome do Produto</label>
          <input type="text" id="r-nome" value="Rise Mode cooler X" placeholder="Digite o nome do produto...">
        </div>

        <div class="field">
          <label>Pre√ßo Prateleira (R$)</label>
          <input type="number" id="r-preco" value="150" step="1" min="0" oninput="calcReverse()">
        </div>

        <div class="field">
          <label>Categoria do Produto</label>
          <select id="r-categoria" onchange="onCategoryChange('r');calcReverse()">
            <option value="cooler">Coolers / Heatsinks</option>
            <option value="psu">Fontes de Alimenta√ß√£o (PSU)</option>
            <option value="case">Gabinetes (Cases)</option>
            <option value="teclado">Teclados</option>
            <option value="mouse">Mouses</option>
            <option value="headset">Headsets / Fones</option>
          </select>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;">
          <span id="r-ncm-badge" class="ncm-badge">NCM 8414.59.90</span>
          <span id="r-ncm-desc" style="font-size:11px;color:var(--text-muted)">Ventiladores / Extratores</span>
        </div>
      </div>

      <div class="card" style="margin-bottom:12px">
        <div class="card-title"><span class="dot" style="background:var(--orange)"></span>Canal, Regime &amp; Par√¢metros</div>

        <div class="field">
          <label>Canal Assumido</label>
          <select id="r-canal" onchange="onCanalChange('r');calcReverse()">
            <option value="direto">Direto (Marca ‚Üí Varejista)</option>
            <option value="distrib">Via Distribui√ß√£o</option>
          </select>
        </div>

        <div class="field">
          <label>Regime Fiscal Assumido</label>
          <select id="r-regime" onchange="onRegimeChange('r');calcReverse()">
            <option value="fundap">FUNDAP/ES ‚Äî II=0%, ICMS‚âà0%</option>
            <option value="normal">Normal ‚Äî SP/RJ/MG ‚Äî II=tabela, ICMS=12%</option>
            <option value="ttd_sc">TTD/SC ‚Äî II=tabela, ICMS‚âà4%</option>
            <option value="custom">Personalizado</option>
          </select>
        </div>

        <div id="r-regime-info" class="regime-badge note note-green" style="display:flex"></div>

        <div class="field" style="margin-top:10px">
          <div class="label-row">
            <label>C√¢mbio USD/BRL</label>
            <span class="val-display" id="r-cambio-disp">5.2458</span>
          </div>
          <input type="number" id="r-cambio" value="5.2458" step="0.01"
            oninput="document.getElementById('r-cambio-disp').textContent=parseFloat(this.value).toFixed(4);calcReverse()">
        </div>

        <div class="field">
          <div class="label-row">
            <label>ICMS Efetivo (%)</label>
            <span class="val-display" id="r-icms-disp">0%</span>
          </div>
          <input type="range" id="r-icms" value="0" min="0" max="20" step="0.5"
            oninput="document.getElementById('r-icms-disp').textContent=parseFloat(this.value).toFixed(1)+'%';calcReverse()">
        </div>

        <div class="field">
          <div class="label-row">
            <label>Markup Varejista (%)</label>
            <span class="val-display" id="r-markup-ret-disp">27%</span>
          </div>
          <input type="range" id="r-markup-ret" value="27" min="5" max="80" step="1"
            oninput="document.getElementById('r-markup-ret-disp').textContent=this.value+'%';calcReverse()">
        </div>

        <div id="r-dist-field" class="field" style="display:none">
          <div class="label-row">
            <label>Markup Distribuidor (%)</label>
            <span class="val-display" id="r-markup-dist-disp">18%</span>
          </div>
          <input type="range" id="r-markup-dist" value="18" min="5" max="50" step="1"
            oninput="document.getElementById('r-markup-dist-disp').textContent=this.value+'%';calcReverse()">
        </div>

        <div class="field">
          <div class="label-row">
            <label>Frete Internacional (% do FOB)</label>
            <span class="val-display" id="r-frete-disp">12%</span>
          </div>
          <input type="range" id="r-frete" value="12" min="3" max="30" step="1"
            oninput="document.getElementById('r-frete-disp').textContent=this.value+'%';calcReverse()">
        </div>

        <div class="field">
          <div class="label-row">
            <label>Despesas Aduaneiras (% CIF)</label>
            <span class="val-display" id="r-aduan-disp">4%</span>
          </div>
          <input type="range" id="r-aduan" value="4" min="1" max="10" step="0.5"
            oninput="document.getElementById('r-aduan-disp').textContent=this.value+'%';calcReverse()">
        </div>

        <div class="btn-row">
          <button class="btn btn-orange" onclick="calcReverse()">‚ü≥ Calcular FOB Estimado</button>
        </div>
      </div>
    </div>

    <!-- RIGHT: RESULTS -->
    <div>
      <div class="result-hero" style="background:linear-gradient(135deg,rgba(57,197,207,0.1),rgba(88,166,255,0.05));border-color:rgba(57,197,207,0.3)">
        <div class="hero-label">FOB Estimado (Pre√ßo de Venda da Marca)</div>
        <div class="hero-val" style="color:var(--cyan)" id="r-result-hero">USD ‚Äî</div>
        <div class="hero-sub" id="r-result-sub">Insira o pre√ßo prateleira para calcular</div>
      </div>

      <div class="metric-row">
        <div class="metric">
          <div class="mval" id="r-met-preco" style="color:var(--text-primary)">‚Äî</div>
          <div class="mlabel">Pre√ßo Varejo</div>
        </div>
        <div class="metric">
          <div class="mval" id="r-met-landed" style="color:var(--yellow)">‚Äî</div>
          <div class="mlabel">Landed Impl√≠cito</div>
        </div>
        <div class="metric">
          <div class="mval" id="r-met-fob" style="color:var(--cyan)">‚Äî</div>
          <div class="mlabel">FOB (USD)</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title"><span class="dot" style="background:var(--cyan)"></span>Breakdown Reverso</div>
        <div class="breakdown" id="r-breakdown">
          <div style="color:var(--text-muted);font-size:13px;padding:20px;text-align:center">
            Configure os par√¢metros acima
          </div>
        </div>
      </div>

      <div class="note" style="background:rgba(57,197,207,0.08);border-color:rgba(57,197,207,0.3);color:var(--cyan)">
        <strong>üí° Uso t√≠pico:</strong> Insira o pre√ßo de prateleira de um concorrente (Rise Mode, Deepcool, etc.) para estimar qual seria o FOB deles (= pre√ßo que a marca cobra do importador). Compare com o FOB CM para entender se a diferen√ßa de pre√ßo vem do produto ou das margens da cadeia.
        <br><br><strong>Importante:</strong> Ajuste o Regime Fiscal para corresponder ao importador do concorrente ‚Äî se ele importa pelo ES (FUNDAP), selecione FUNDAP; se pelo SP, selecione Normal.
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 3: COMPARADOR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-comparador" class="tab-panel">
  <div style="margin-bottom:16px;display:flex;justify-content:space-between;align-items:center">
    <div>
      <div style="font-size:16px;font-weight:700">Comparador Lado a Lado</div>
      <div style="font-size:12px;color:var(--text-muted);margin-top:2px">Compare CM com concorrente ‚Äî identifique onde est√° a diferen√ßa de pre√ßo</div>
    </div>
    <button class="btn btn-orange" onclick="runComparador()">‚ü≥ Comparar</button>
  </div>

  <div class="grid-2" style="margin-bottom:16px">
    <!-- PRODUTO CM -->
    <div class="comp-col highlight">
      <div class="comp-header">
        <div style="background:var(--orange);color:#0d1117;border-radius:6px;padding:4px 10px;font-size:12px;font-weight:800">CM</div>
        <input type="text" id="c-cm-nome" value="CM Hyper 212 Spectrum">
      </div>
      <div class="field">
        <label>FOB (USD) <span style="color:var(--orange);font-size:11px">= Pre√ßo de venda CM (margem j√° inclusa)</span></label>
        <input type="number" id="c-cm-fob" value="9.00" step="0.01">
      </div>
      <div class="field">
        <label>Categoria</label>
        <select id="c-cm-cat" onchange="onCategoryChange('c-cm')">
          <option value="cooler">Coolers / Heatsinks</option>
          <option value="psu">Fontes de Alimenta√ß√£o</option>
          <option value="case">Gabinetes</option>
          <option value="teclado">Teclados</option>
          <option value="mouse">Mouses</option>
          <option value="headset">Headsets</option>
        </select>
      </div>
      <div class="field">
        <label>Regime Fiscal</label>
        <select id="c-cm-regime">
          <option value="fundap">FUNDAP/ES (KaBuM)</option>
          <option value="normal">Normal/SP</option>
          <option value="ttd_sc">TTD/SC</option>
          <option value="custom">Personalizado</option>
        </select>
      </div>
      <div class="field">
        <label>Canal</label>
        <select id="c-cm-canal">
          <option value="direto">Direto</option>
          <option value="distrib">Distribui√ß√£o</option>
        </select>
      </div>
      <div class="field">
        <div class="label-row"><label>Markup Varejista (%)</label><span class="val-display" id="c-cm-mret-d">27%</span></div>
        <input type="range" id="c-cm-mret" value="27" min="5" max="80" step="1" oninput="document.getElementById('c-cm-mret-d').textContent=this.value+'%'">
      </div>
    </div>

    <!-- CONCORRENTE -->
    <div class="comp-col">
      <div class="comp-header">
        <div style="background:var(--text-muted);color:#0d1117;border-radius:6px;padding:4px 10px;font-size:12px;font-weight:800">CONC</div>
        <input type="text" id="c-conc-nome" value="Rise Mode Odin 212">
      </div>
      <div class="field">
        <label>FOB (USD) ‚Äî <span style="color:var(--cyan);font-size:11px">deixe 0 para calcular pelo pre√ßo</span></label>
        <input type="number" id="c-conc-fob" value="0" step="0.01">
      </div>
      <div style="text-align:center;color:var(--text-muted);font-size:12px;margin:4px 0">OU</div>
      <div class="field">
        <label>Pre√ßo Prateleira Concorrente (R$)</label>
        <input type="number" id="c-conc-preco" value="150" step="1">
      </div>
      <div class="field">
        <label>Categoria</label>
        <select id="c-conc-cat" onchange="onCategoryChange('c-conc')">
          <option value="cooler">Coolers / Heatsinks</option>
          <option value="psu">Fontes de Alimenta√ß√£o</option>
          <option value="case">Gabinetes</option>
          <option value="teclado">Teclados</option>
          <option value="mouse">Mouses</option>
          <option value="headset">Headsets</option>
        </select>
      </div>
      <div class="field">
        <label>Regime Fiscal</label>
        <select id="c-conc-regime">
          <option value="fundap">FUNDAP/ES</option>
          <option value="normal">Normal/SP</option>
          <option value="ttd_sc">TTD/SC</option>
          <option value="custom">Personalizado</option>
        </select>
      </div>
      <div class="field">
        <div class="label-row"><label>Markup Varejista (%)</label><span class="val-display" id="c-conc-mret-d">27%</span></div>
        <input type="range" id="c-conc-mret" value="27" min="5" max="80" step="1" oninput="document.getElementById('c-conc-mret-d').textContent=this.value+'%'">
      </div>
    </div>
  </div>

  <!-- RESULTADO COMPARADOR -->
  <div class="card" id="comp-result" style="display:none">
    <div class="card-title"><span class="dot" style="background:var(--yellow)"></span>An√°lise Comparativa</div>
    <div id="comp-result-body"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 4: AJUSTES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-ajustes" class="tab-panel">
  <div class="grid-3">

    <!-- Al√≠quotas -->
    <div>
      <div class="card">
        <div class="card-title"><span class="dot" style="background:var(--red)"></span>Al√≠quotas por Categoria (II / IPI)</div>
        <div class="note" style="margin-top:0;margin-bottom:12px;font-size:11px">
          <strong>Fonte:</strong> TIPI/TEC Brasil. II √© a al√≠quota padr√£o (sobreposta pelo Regime Fiscal ao calcular ‚Äî FUNDAP usa II=0%).
        </div>
        <div id="aliquotas-editor"></div>
      </div>
    </div>

    <!-- Regimes & C√¢mbio -->
    <div>
      <div class="card" style="margin-bottom:12px">
        <div class="card-title"><span class="dot" style="background:var(--green)"></span>Regimes Fiscais</div>
        <div id="regimes-info"></div>
      </div>

      <div class="card">
        <div class="card-title"><span class="dot" style="background:var(--blue)"></span>C√¢mbio</div>
        <div class="field">
          <label>Taxa USD/BRL atual</label>
          <input type="number" id="g-cambio" value="5.2458" step="0.01" min="1" oninput="syncCambio(this.value)">
        </div>
        <div class="note" style="margin-top:8px">
          √öltima cota√ß√£o: <strong>R$ 5.2458</strong> (17/02/2026 05:26 BRT).<br>
          Fonte: Banco Central / AwesomeAPI.
        </div>
      </div>
    </div>

    <!-- Metodologia + Valida√ß√£o -->
    <div>
      <div class="card" style="margin-bottom:12px">
        <div class="card-title"><span class="dot" style="background:var(--purple)"></span>Metodologia de C√°lculo (v2.0)</div>
        <div style="font-size:12px;color:var(--text-secondary);line-height:1.8">
          <div style="margin-bottom:6px"><strong style="color:var(--orange)">‚ö†Ô∏è Premissa Fundamental:</strong></div>
          <div style="background:rgba(240,136,62,0.1);border:1px solid rgba(240,136,62,0.3);border-radius:6px;padding:8px 10px;margin-bottom:10px;font-size:11px">
            <strong>FOB = Pre√ßo de venda CM ‚Üí cliente</strong><br>
            A margem CM j√° est√° embutida no FOB. N√£o se adiciona margem CM adicional.
          </div>

          <div style="margin-bottom:8px"><strong style="color:var(--text-primary)">F√≥rmula Importa√ß√£o:</strong></div>
          <div style="background:var(--bg-secondary);padding:10px;border-radius:6px;font-family:monospace;font-size:11px;line-height:1.9;color:var(--green)">
            FOB_BRL = FOB_USD √ó C√¢mbio<br>
            Frete_BRL = FOB_BRL √ó frete%<br>
            CIF = FOB_BRL + Frete + Seguro<br>
            II = CIF √ó ii_ef%  ‚Üê 0% no FUNDAP<br>
            IPI = (CIF + II) √ó ipi%<br>
            PIS = CIF √ó 2,10%  (federal fixo)<br>
            COFINS = CIF √ó 9,65%  (federal fixo)<br>
            Desp = CIF √ó desp%<br>
            Base_ICMS = (CIF+II+IPI+PIS+COFINS+Desp)<br>
            ICMS = Base √∑ (1‚àíicms_ef%) √ó icms_ef%<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚Üê 0% no FUNDAP/ES<br>
            ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<br>
            Landed = CIF+II+IPI+PIS+COFINS+ICMS+Desp
          </div>

          <div style="margin-top:12px;margin-bottom:8px"><strong style="color:var(--text-primary)">Forma√ß√£o de Pre√ßo:</strong></div>
          <div style="background:var(--bg-secondary);padding:10px;border-radius:6px;font-family:monospace;font-size:11px;line-height:1.9;color:var(--blue)">
            <span style="color:var(--green)">// Markup: pre√ßo = custo √ó (1 + m%)</span><br>
            <span style="color:var(--red)">// N√ÉO √© GP margin √∑ (1‚àím%)!</span><br>
            <br>
            P_Dist = Landed √ó (1 + markup_dist%)<br>
            P_Consumidor = P_Base √ó (1 + markup_ret%)<br>
            <br>
            <span style="color:var(--yellow)">// Equival√™ncia: markup 27% ‚â° GP 21,3%</span><br>
            <span style="color:var(--yellow)">// R$78 √∑ 1,27 = R$61,42 (custo)</span>
          </div>

          <div style="margin-top:10px;color:var(--text-muted);font-size:11px">
            <strong style="color:var(--yellow)">Regimes especiais:</strong><br>
            ‚Ä¢ <strong>FUNDAP/ES:</strong> ICMS financiado pelo estado ES (custo l√≠quido ‚âà 0%) + benef√≠cios que reduzem II a 0% efetivo.<br>
            ‚Ä¢ <strong>TTD/SC:</strong> SC concede Tratamento Tribut√°rio Diferenciado ‚Äî ICMS efetivo ~4%.<br>
            ‚Ä¢ <strong>Normal:</strong> Tributa√ß√£o padr√£o TIPI + ICMS 12% interestadual.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title"><span class="dot" style="background:var(--yellow)"></span>‚úÖ Valida√ß√£o: Hyper 212 Spectrum</div>
        <div id="validacao-hyper" style="font-size:12px;color:var(--text-secondary)">
          <button class="btn btn-ghost" style="margin-bottom:10px;width:100%" onclick="validarHyper212()">‚ñ∂ Rodar Valida√ß√£o (deve dar R$78)</button>
          <div id="validacao-resultado"></div>
        </div>
      </div>
    </div>
  </div>
</div>

</div><!-- /main -->

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA TABLES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const CATEGORIAS = {
  cooler:  { label: 'Coolers / Heatsinks',    ncm: '8414.59.90', desc: 'Ventiladores e extratores', ii: 14, ipi: 0 },
  psu:     { label: 'Fontes de Alimenta√ß√£o',  ncm: '8504.40.40', desc: 'Conversores est√°ticos',     ii: 12, ipi: 0 },
  case:    { label: 'Gabinetes (Cases)',       ncm: '8473.30.49', desc: 'Partes p/ m√°quinas ADP',    ii: 14, ipi: 0 },
  teclado: { label: 'Teclados',               ncm: '8471.60.52', desc: 'Teclados para computador',  ii: 20, ipi: 0 },
  mouse:   { label: 'Mouses',                 ncm: '8471.60.53', desc: 'Dispositivos apontadores',  ii: 20, ipi: 0 },
  headset: { label: 'Headsets / Fones',       ncm: '8518.30.00', desc: 'Fones de ouvido',           ii: 20, ipi: 0 },
};

const PIS_IMP    = 2.10;
const COFINS_IMP = 9.65;

// Regimes fiscais com suas al√≠quotas efetivas
const REGIMES = {
  fundap: {
    label: 'FUNDAP/ES',
    desc: 'Esp√≠rito Santo ‚Äî FUNDAP (ICMS‚âà0%) + Regime Especial Federal (II=0%)',
    ii_override: 0,      // sobreescreve o II da categoria para 0
    icms_ef: 0,          // ICMS efetivo = 0% (FUNDAP financia)
    note: '‚ö° FUNDAP/ES: ICMS financiado pelo estado (custo l√≠quido ‚âà 0%) + benef√≠cios federais que zeram o II. Regime validado: FOB $9 ‚Üí R$61,51 landed ‚Üí √ó1,27 = <strong>R$78,12 ‚úÖ</strong>',
    color: 'var(--green)',
    bgClass: 'note-green',
  },
  normal: {
    label: 'Normal/SP',
    desc: 'SP / RJ / MG ‚Äî Tributa√ß√£o padr√£o, sem benef√≠cios especiais',
    ii_override: null,   // usa a al√≠quota da categoria
    icms_ef: 12,
    note: 'üìã Tributa√ß√£o padr√£o: II conforme NCM (TIPI), ICMS 12% (opera√ß√£o interestadual). Ex: Terabyte, VAIP, All Nations.',
    color: 'var(--blue)',
    bgClass: 'note-blue',
  },
  ttd_sc: {
    label: 'TTD/SC',
    desc: 'Santa Catarina ‚Äî Tratamento Tribut√°rio Diferenciado',
    ii_override: null,
    icms_ef: 4,
    note: 'üìç SC/TTD: Tratamento Tribut√°rio Diferenciado ‚Äî ICMS efetivo ~4% (vs 12% padr√£o). Pichau, Mazer, Oder√ßo operam neste regime.',
    color: 'var(--purple)',
    bgClass: 'note-purple',
  },
  custom: {
    label: 'Personalizado',
    desc: 'Definir II e ICMS manualmente nos campos abaixo',
    ii_override: null,
    icms_ef: null,
    note: '‚öôÔ∏è Regime personalizado: ajuste o ICMS efetivo pelo slider. O II ser√° o padr√£o da categoria (edite em Al√≠quotas & Config).',
    color: 'var(--yellow)',
    bgClass: '',
  },
};

const CLIENTES = {
  kabum:      { label: 'KaBuM',       estado: 'ES', regime: 'fundap' },
  terabyte:   { label: 'Terabyte',    estado: 'SP', regime: 'normal' },
  mazer:      { label: 'Mazer',       estado: 'SC', regime: 'ttd_sc' },
  pichau:     { label: 'Pichau',      estado: 'SC', regime: 'ttd_sc' },
  oderco:     { label: 'Oder√ßo',      estado: 'SC', regime: 'ttd_sc' },
  vaip:       { label: 'VAIP',        estado: 'SP', regime: 'normal' },
  allnations: { label: 'All Nations', estado: 'SP', regime: 'normal' },
  custom:     { label: 'Personalizado', estado: '?', regime: 'custom' },
};

// Al√≠quotas edit√°veis (usadas em todos os c√°lculos ‚Äî II padr√£o sem regime especial)
let ALIQ = {};
function resetAliq() {
  ALIQ = {};
  for (const k in CATEGORIAS) {
    ALIQ[k] = { ii: CATEGORIAS[k].ii, ipi: CATEGORIAS[k].ipi };
  }
}
resetAliq();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getEffectiveRates(prefix) {
  const regimeKey = document.getElementById(prefix + '-regime')
                  ? document.getElementById(prefix + '-regime').value : 'normal';
  const regime = REGIMES[regimeKey] || REGIMES['normal'];
  const catEl = document.getElementById(prefix + '-categoria') || document.getElementById(prefix + '-cat');
  const cat = catEl ? catEl.value : 'cooler';
  const aliq = ALIQ[cat] || ALIQ['cooler'];

  const ii_pct = (regime.ii_override !== null && regime.ii_override !== undefined)
               ? regime.ii_override
               : aliq.ii;

  const icmsEl = document.getElementById(prefix + '-icms');
  const icms_pct = (regime.icms_ef !== null && regime.icms_ef !== undefined)
                 ? regime.icms_ef
                 : (icmsEl ? parseFloat(icmsEl.value) || 0 : 12);

  return { ii_pct, icms_pct, aliq, regime, regimeKey };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(name, btn) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  if (btn) btn.classList.add('active');
  if (name === 'ajustes') buildAjustesUI();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CATEGORY / CANAL / CLIENTE / REGIME CHANGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function onCategoryChange(prefix) {
  const sel = document.getElementById(prefix + '-categoria') || document.getElementById(prefix + '-cat');
  if (!sel) return;
  const cat = CATEGORIAS[sel.value] || CATEGORIAS['cooler'];
  const badgeEl = document.getElementById(prefix + '-ncm-badge');
  const descEl  = document.getElementById(prefix + '-ncm-desc');
  if (badgeEl) badgeEl.textContent = 'NCM ' + cat.ncm;
  if (descEl)  descEl.textContent  = cat.desc;
}

function onCanalChange(prefix) {
  const canal = document.getElementById(prefix + '-canal').value;
  const distField = document.getElementById(prefix + '-dist-field');
  if (distField) distField.style.display = canal === 'distrib' ? 'block' : 'none';
}

function onClienteChange(prefix) {
  const key = document.getElementById(prefix + '-cliente').value;
  const cli = CLIENTES[key];
  if (!cli) return;
  // Update regime dropdown
  const regimeEl = document.getElementById(prefix + '-regime');
  if (regimeEl) {
    regimeEl.value = cli.regime;
    onRegimeChange(prefix);
  }
  calcForward();
}

function onRegimeChange(prefix) {
  const regimeEl = document.getElementById(prefix + '-regime');
  if (!regimeEl) return;
  const regime = REGIMES[regimeEl.value] || REGIMES['normal'];

  // Update ICMS slider
  const icmsEl    = document.getElementById(prefix + '-icms');
  const icmsDisp  = document.getElementById(prefix + '-icms-disp');
  if (icmsEl && regime.icms_ef !== null && regime.icms_ef !== undefined) {
    icmsEl.value = regime.icms_ef;
    if (icmsDisp) icmsDisp.textContent = regime.icms_ef.toFixed(1) + '%';
    // Disable slider for non-custom regimes (visual only ‚Äî still editable as override)
    icmsEl.style.opacity = (regimeEl.value === 'custom') ? '1' : '0.7';
  }

  // Update regime info badge
  updateRegimeBadge(prefix, regimeEl.value);
}

function updateRegimeBadge(prefix, regimeKey) {
  const infoEl = document.getElementById(prefix + '-regime-info');
  if (!infoEl) return;
  const regime = REGIMES[regimeKey] || REGIMES['normal'];
  const catEl = document.getElementById(prefix + '-categoria') || document.getElementById(prefix + '-cat');
  const cat = catEl ? catEl.value : 'cooler';
  const ii_label = (regime.ii_override !== null && regime.ii_override !== undefined)
                 ? regime.ii_override + '%'
                 : (ALIQ[cat] ? ALIQ[cat].ii + '%' : '‚Äî');
  const icms_label = (regime.icms_ef !== null && regime.icms_ef !== undefined)
                   ? regime.icms_ef + '%' : 'manual';

  infoEl.className = 'regime-badge note ' + regime.bgClass;
  infoEl.style.display = 'flex';
  infoEl.innerHTML =
    `<div style="flex:1">
      <div style="font-weight:700;margin-bottom:2px">${regime.label} ‚Äî ${regime.desc}</div>
      <div style="font-size:10px;opacity:0.8;margin-top:3px">
        II efetivo: <strong>${ii_label}</strong> &nbsp;|&nbsp;
        ICMS efetivo: <strong>${icms_label}</strong> &nbsp;|&nbsp;
        PIS+COFINS: <strong>11,75%</strong> (federal, fixo)
      </div>
      <div style="margin-top:5px;font-size:11px">${regime.note}</div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CORE IMPORT CALC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcImport(params) {
  // params: { fobUSD, cambio, frete_pct, seguro_pct, ii_pct, ipi_pct, icms_pct, despesas_pct }
  const fob_brl  = params.fobUSD * params.cambio;
  const frete    = fob_brl * (params.frete_pct / 100);
  const cif      = fob_brl + frete + (fob_brl + frete) * (params.seguro_pct / 100);
  const ii       = cif * (params.ii_pct / 100);
  const ipi      = (cif + ii) * (params.ipi_pct / 100);
  const pis      = cif * (PIS_IMP / 100);
  const cofins   = cif * (COFINS_IMP / 100);
  const despesas = cif * (params.despesas_pct / 100);
  // ICMS por dentro
  const pre_icms   = cif + ii + ipi + pis + cofins + despesas;
  const icms_pct_d = params.icms_pct / 100;
  const icms       = icms_pct_d > 0 ? pre_icms * icms_pct_d / (1 - icms_pct_d) : 0;
  const landed     = pre_icms + icms;
  const total_tax  = ii + ipi + pis + cofins + icms;

  return { fob_brl, frete, cif, ii, ipi, pis, cofins, despesas, icms, landed, total_tax, pre_icms };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FORMAT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fmtBRL(v) {
  return 'R$ ' + v.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}
function fmtUSD(v) { return 'USD ' + v.toFixed(2); }
function fmtPct(v) { return v.toFixed(1) + '%'; }
function pctOf(part, total) { return total ? (part / total) * 100 : 0; }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FORWARD CALC  (FOB ‚Üí Varejo)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcForward() {
  const rates = getEffectiveRates('f');
  const canal = document.getElementById('f-canal').value;

  const fobUSD = parseFloat(document.getElementById('f-fob').value) || 0;
  if (!fobUSD) return;

  const params = {
    fobUSD,
    cambio:       parseFloat(document.getElementById('f-cambio').value) || 5.25,
    frete_pct:    parseFloat(document.getElementById('f-frete').value)  || 12,
    seguro_pct:   parseFloat(document.getElementById('f-seguro').value) || 0.5,
    ii_pct:       rates.ii_pct,
    ipi_pct:      rates.aliq.ipi,
    icms_pct:     rates.icms_pct,
    despesas_pct: parseFloat(document.getElementById('f-aduan').value)  || 4,
  };

  const imp = calcImport(params);

  const markup_dist = (parseFloat(document.getElementById('f-markup-dist').value) || 18) / 100;
  const markup_ret  = (parseFloat(document.getElementById('f-markup-ret').value)  || 27) / 100;

  let p_dist_sell = 0;
  let p_shelf;
  if (canal === 'direto') {
    p_shelf = imp.landed * (1 + markup_ret);
  } else {
    p_dist_sell = imp.landed * (1 + markup_dist);
    p_shelf     = p_dist_sell * (1 + markup_ret);
  }

  // Update metrics
  document.getElementById('f-met-fob').textContent    = fmtBRL(imp.fob_brl);
  document.getElementById('f-met-landed').textContent = fmtBRL(imp.landed);
  const carga_pct = pctOf(imp.total_tax, imp.landed);
  document.getElementById('f-met-taxa').textContent   = fmtPct(carga_pct);

  const multip = imp.fob_brl > 0 ? (p_shelf / imp.fob_brl) : 0;
  document.getElementById('f-result-hero').textContent = fmtBRL(p_shelf);
  document.getElementById('f-result-sub').textContent  =
    'Multiplicador: ' + multip.toFixed(2) + 'x FOB BRL | Landed: ' + fmtBRL(imp.landed) +
    ' | Regime: ' + rates.regime.label;

  // Breakdown HTML
  const bk = document.getElementById('f-breakdown');
  const row = (label, val, cls, icon) =>
    `<div class="bline ${cls||''}">
      <span class="blabel">${icon ? '<span>'+icon+'</span>' : ''} ${label}</span>
      <span class="bval">${val}</span>
    </div>`;

  let html = '';
  html += '<div class="section-header">Origem</div>';
  html += row('FOB Unit√°rio (USD ' + fobUSD.toFixed(2) + ') ‚Äî Pre√ßo de Venda CM', fmtBRL(imp.fob_brl), 'fob-line', 'üîµ');
  html += row('Frete Internacional (' + params.frete_pct + '% FOB)', fmtBRL(imp.frete), '', 'üö¢');
  html += row('Seguro (' + params.seguro_pct + '% FOB+Frete)', fmtBRL(imp.cif - imp.fob_brl - imp.frete), '', 'üõ°Ô∏è');
  html += row('CIF (Cost, Insurance &amp; Freight)', fmtBRL(imp.cif), 'subtotal', 'üì¶');

  html += '<div class="section-header">Tributos na Importa√ß√£o ‚Äî Regime: ' + rates.regime.label + '</div>';
  if (rates.ii_pct > 0) {
    html += row('II ‚Äî Imposto de Importa√ß√£o (' + rates.ii_pct + '% do CIF)', fmtBRL(imp.ii), 'tax-line', 'üèõÔ∏è');
  } else {
    html += row('II ‚Äî Imposto de Importa√ß√£o (' + rates.regime.label + ': 0% efetivo)', fmtBRL(0), 'zero-tax', '‚úÖ');
  }

  if (rates.aliq.ipi > 0) {
    html += row('IPI (' + rates.aliq.ipi + '%)', fmtBRL(imp.ipi), 'tax-line', 'üèõÔ∏è');
  } else {
    html += row('IPI (0% ‚Äî inform√°tica)', fmtBRL(0), 'zero-tax', '‚úÖ');
  }

  html += row('PIS Importa√ß√£o (2,10% CIF ‚Äî federal fixo)', fmtBRL(imp.pis),    'tax-line', 'üèõÔ∏è');
  html += row('COFINS Importa√ß√£o (9,65% CIF ‚Äî federal fixo)', fmtBRL(imp.cofins), 'tax-line', 'üèõÔ∏è');

  if (rates.icms_pct > 0) {
    html += row('ICMS Importa√ß√£o (' + rates.icms_pct + '% por dentro)', fmtBRL(imp.icms), 'tax-line', 'üèõÔ∏è');
  } else {
    html += row('ICMS Importa√ß√£o (' + rates.regime.label + ': 0% efetivo)', fmtBRL(0), 'zero-tax', '‚úÖ');
  }

  html += row('Despesas Aduaneiras &amp; Handling (' + params.despesas_pct + '% CIF)', fmtBRL(imp.despesas), '', '‚öì');
  html += row('<strong>LANDED COST TOTAL</strong>', fmtBRL(imp.landed), 'subtotal', 'üéØ');

  const pis_cofins = imp.pis + imp.cofins;
  html += row('Carga Tribut√°ria Efetiva (s/ landed)', fmtPct(carga_pct), 'tax-line', 'üìä');

  if (canal === 'distrib') {
    html += '<div class="section-header">Distribuidor</div>';
    const dist_margin_brl = p_dist_sell * markup_dist;
    html += row('Landed (custo do distribuidor)', fmtBRL(imp.landed), '', '');
    html += row('Markup Distribuidor (' + (markup_dist*100).toFixed(0) + '%)', '+' + fmtBRL(dist_margin_brl), 'margin-line', 'üíö');
    html += row('Pre√ßo Distribuidor ‚Üí Varejista', fmtBRL(p_dist_sell), 'subtotal', '');
  }

  html += '<div class="section-header">Varejista</div>';
  const base_ret    = canal === 'direto' ? imp.landed : p_dist_sell;
  const ret_margin_brl = p_shelf * markup_ret;
  const gp_equiv    = (1 - 1/(1+markup_ret)) * 100;
  html += row('Custo do Varejista (= landed' + (canal==='distrib' ? ' via dist.' : '') + ')', fmtBRL(base_ret), '', '');
  html += row(
    'Markup Varejista (' + (markup_ret*100).toFixed(0) + '%) <span style="color:var(--text-muted);font-weight:400">‚â° GP ' + gp_equiv.toFixed(1) + '%</span>',
    '+' + fmtBRL(ret_margin_brl), 'margin-line', 'üíö'
  );
  html += `<div class="bline total"><span class="blabel">üõí PRE√áO AO CONSUMIDOR</span><span class="bval">${fmtBRL(p_shelf)}</span></div>`;

  bk.innerHTML = html;

  // Waterfall
  buildWaterfall('f', imp, canal === 'distrib' ? p_dist_sell : null, p_shelf, markup_dist, markup_ret);

  // Note
  const noteEl = document.getElementById('f-note');
  noteEl.style.display = 'block';
  const catKey = document.getElementById('f-categoria').value;
  const cat = CATEGORIAS[catKey] || CATEGORIAS['cooler'];
  noteEl.innerHTML =
    `<strong>üìå NCM ${cat.ncm}</strong> ‚Äî ${cat.desc}. Regime: <strong>${rates.regime.label}</strong>.` +
    ` Multiplicador FOB BRL‚ÜíVarejo: <strong>${multip.toFixed(2)}x</strong>.` +
    ` Carga tribut√°ria efetiva: <strong>${fmtPct(carga_pct)}</strong> do landed.` +
    `<br>Markup varejista: <strong>${(markup_ret*100).toFixed(0)}%</strong>` +
    ` = GP equivalente <strong>${(pctOf(p_shelf-base_ret, p_shelf)).toFixed(1)}%</strong>.` +
    `<br><span style="color:var(--text-muted)">F√≥rmula markup: Pre√ßo = Custo √ó (1 + ${(markup_ret*100).toFixed(0)}%) | Al√≠quotas PIS/COFINS s√£o federais e fixas.</span>`;
}

function resetForward() {
  document.getElementById('f-fob').value = '9.00';
  document.getElementById('f-cambio').value = '5.2458';
  document.getElementById('f-cambio-disp').textContent = '5.2458';
  document.getElementById('f-frete').value = '12';
  document.getElementById('f-frete-disp').textContent = '12%';
  document.getElementById('f-seguro').value = '0.5';
  document.getElementById('f-seguro-disp').textContent = '0.5%';
  document.getElementById('f-aduan').value = '4';
  document.getElementById('f-aduan-disp').textContent = '4%';
  document.getElementById('f-markup-dist').value = '18';
  document.getElementById('f-markup-dist-disp').textContent = '18%';
  document.getElementById('f-markup-ret').value = '27';
  document.getElementById('f-markup-ret-disp').textContent = '27%';
  document.getElementById('f-cliente').value = 'kabum';
  document.getElementById('f-regime').value  = 'fundap';
  onRegimeChange('f');
  calcForward();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WATERFALL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildWaterfall(prefix, imp, p_dist, p_ret, markup_dist, markup_ret) {
  const el = document.getElementById(prefix + '-waterfall');
  if (!el) return;

  const base_ret = p_dist || imp.landed;
  const bars = [
    { label: 'FOB BRL',     val: imp.fob_brl,           color: '#58a6ff' },
    { label: 'Frete+Seguro',val: imp.cif - imp.fob_brl, color: '#8b949e' },
    { label: 'II + IPI',    val: imp.ii + imp.ipi,       color: '#f85149' },
    { label: 'PIS+COFINS',  val: imp.pis + imp.cofins,   color: '#f85149' },
    { label: 'ICMS',        val: imp.icms,               color: '#d29922' },
    { label: 'Despesas',    val: imp.despesas,           color: '#8b949e' },
    { label: p_dist ? 'Markup Dist.' : null, val: p_dist ? p_dist * markup_dist : 0, color: '#3fb950' },
    { label: 'Markup Ret.', val: p_ret * markup_ret,    color: '#3fb950' },
  ].filter(b => b.label && b.val > 0);

  el.innerHTML = bars.map(b => {
    const pct = Math.max(2, (b.val / p_ret) * 100);
    return `<div class="wf-bar-row">
      <div class="wf-label">${b.label}</div>
      <div class="wf-bar-wrap">
        <div class="wf-bar" style="width:${pct}%;background:${b.color}"></div>
        <span class="wf-barval">${fmtBRL(b.val)}</span>
      </div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REVERSE CALC  (Varejo ‚Üí FOB)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcReverse() {
  const preco_shelf = parseFloat(document.getElementById('r-preco').value) || 0;
  if (!preco_shelf) return;

  const rates     = getEffectiveRates('r');
  const canal     = document.getElementById('r-canal').value;
  const cambio    = parseFloat(document.getElementById('r-cambio').value) || 5.25;
  const frete_pct = parseFloat(document.getElementById('r-frete').value)  || 12;
  const desp_pct  = parseFloat(document.getElementById('r-aduan').value)  || 4;
  const markup_ret  = (parseFloat(document.getElementById('r-markup-ret').value)  || 27) / 100;
  const markup_dist = (parseFloat(document.getElementById('r-markup-dist').value) || 18) / 100;

  // Strip retail markups to get landed
  let landed;
  let p_dist_cost = null;
  if (canal === 'direto') {
    landed = preco_shelf / (1 + markup_ret);
  } else {
    const p_dist_shelf = preco_shelf / (1 + markup_ret);
    p_dist_cost = p_dist_shelf;
    landed = p_dist_shelf / (1 + markup_dist);
  }

  // Binary search: find CIF such that calcImport produces this landed
  function landedFromCIF(cif) {
    const ii     = cif * (rates.ii_pct / 100);
    const ipi    = (cif + ii) * (rates.aliq.ipi / 100);
    const pis    = cif * (PIS_IMP / 100);
    const cofins = cif * (COFINS_IMP / 100);
    const desp   = cif * (desp_pct / 100);
    const pre    = cif + ii + ipi + pis + cofins + desp;
    const icms   = rates.icms_pct > 0
                 ? pre * (rates.icms_pct / 100) / (1 - rates.icms_pct / 100)
                 : 0;
    return pre + icms;
  }

  let lo = 0, hi = landed * 3, cif_est = landed * 0.7;
  for (let i = 0; i < 60; i++) {
    const mid = (lo + hi) / 2;
    if (landedFromCIF(mid) < landed) lo = mid; else hi = mid;
    cif_est = (lo + hi) / 2;
  }

  // FOB from CIF
  const seguro_pct = 0.5;
  const fob_brl    = cif_est / ((1 + frete_pct / 100) * (1 + seguro_pct / 100));
  const fob_usd    = fob_brl / cambio;

  const imp = calcImport({
    fobUSD: fob_usd, cambio, frete_pct, seguro_pct,
    ii_pct: rates.ii_pct, ipi_pct: rates.aliq.ipi,
    icms_pct: rates.icms_pct, despesas_pct: desp_pct,
  });

  // Update UI
  document.getElementById('r-met-preco').textContent   = fmtBRL(preco_shelf);
  document.getElementById('r-met-landed').textContent  = fmtBRL(imp.landed);
  document.getElementById('r-met-fob').textContent     = fmtUSD(fob_usd);
  document.getElementById('r-result-hero').textContent = fmtUSD(fob_usd);
  document.getElementById('r-result-sub').textContent  =
    'Landed impl√≠cito: ' + fmtBRL(imp.landed) + ' | Regime: ' + rates.regime.label + ' | C√¢mbio: R$' + cambio.toFixed(4);

  const bk  = document.getElementById('r-breakdown');
  const row = (lbl, val, cls, ico) =>
    `<div class="bline ${cls||''}"><span class="blabel">${ico?'<span>'+ico+'</span>':''} ${lbl}</span><span class="bval">${val}</span></div>`;

  let html = '';
  html += `<div class="bline total"><span class="blabel">üõí Pre√ßo Prateleira</span><span class="bval">${fmtBRL(preco_shelf)}</span></div>`;
  html += '<div class="section-header">Desconstruindo as Margens</div>';

  html += row('Markup Varejista (' + (markup_ret*100).toFixed(0) + '%)', '‚àí' + fmtBRL(preco_shelf * markup_ret / (1 + markup_ret)), 'tax-line', '‚Ü©Ô∏è');
  const base_after_ret = preco_shelf / (1 + markup_ret);
  html += row('Custo do Varejista (= landed' + (canal === 'distrib' ? ' via dist.' : '') + ')', fmtBRL(base_after_ret), 'subtotal', '');

  if (canal === 'distrib') {
    html += row('Markup Distribuidor (' + (markup_dist*100).toFixed(0) + '%)', '‚àí' + fmtBRL(base_after_ret * markup_dist / (1 + markup_dist)), 'tax-line', '‚Ü©Ô∏è');
    html += row('<strong>Landed Cost Impl√≠cito</strong>', fmtBRL(imp.landed), 'subtotal', 'üéØ');
  }

  html += '<div class="section-header">Desconstruindo o Landed ‚Äî Regime: ' + rates.regime.label + '</div>';
  if (rates.icms_pct > 0) {
    html += row('ICMS Importa√ß√£o (' + rates.icms_pct + '%)', '‚àí' + fmtBRL(imp.icms), 'tax-line', 'üèõÔ∏è');
  } else {
    html += row('ICMS (0% ‚Äî ' + rates.regime.label + ')', fmtBRL(0), 'zero-tax', '‚úÖ');
  }
  html += row('Despesas Aduaneiras (' + desp_pct + '%)', '‚àí' + fmtBRL(imp.despesas), 'tax-line', '‚öì');
  html += row('COFINS Importa√ß√£o (9,65%)', '‚àí' + fmtBRL(imp.cofins), 'tax-line', 'üèõÔ∏è');
  html += row('PIS Importa√ß√£o (2,10%)', '‚àí' + fmtBRL(imp.pis), 'tax-line', 'üèõÔ∏è');
  if (rates.aliq.ipi > 0) html += row('IPI (' + rates.aliq.ipi + '%)', '‚àí' + fmtBRL(imp.ipi), 'tax-line', 'üèõÔ∏è');
  if (rates.ii_pct > 0) {
    html += row('II (' + rates.ii_pct + '%)', '‚àí' + fmtBRL(imp.ii), 'tax-line', 'üèõÔ∏è');
  } else {
    html += row('II (0% ‚Äî ' + rates.regime.label + ')', fmtBRL(0), 'zero-tax', '‚úÖ');
  }
  html += row('Seguro + Frete (' + frete_pct + '% + 0,5%)', '‚àí' + fmtBRL(imp.cif - imp.fob_brl), '', 'üö¢');
  html += row('<strong>CIF Estimado</strong>', fmtBRL(imp.cif), 'subtotal', 'üì¶');
  html += row('FOB (BRL)', fmtBRL(fob_brl), 'fob-line', 'üîµ');
  html += `<div class="bline" style="background:var(--cyan-dim);border:1px solid rgba(57,197,207,0.4);margin-top:4px">
    <span class="blabel" style="color:var(--cyan);font-weight:700">üí° FOB ESTIMADO (USD) ‚Äî Pre√ßo de Venda da Marca</span>
    <span class="bval" style="color:var(--cyan)">${fmtUSD(fob_usd)}</span>
  </div>`;

  bk.innerHTML = html;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMPARADOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function runComparador() {
  const cambio = parseFloat(document.getElementById('g-cambio').value) || 5.2458;

  function calcProduct(prefix) {
    const cat      = document.getElementById(prefix + '-cat').value;
    const aliq     = ALIQ[cat] || ALIQ['cooler'];
    const canal    = document.getElementById(prefix + '-canal') ? document.getElementById(prefix + '-canal').value : 'direto';
    const regimeKey = document.getElementById(prefix + '-regime').value;
    const regime   = REGIMES[regimeKey] || REGIMES['normal'];
    const markup_ret = (parseFloat(document.getElementById(prefix + '-mret').value) || 27) / 100;

    const ii_pct   = (regime.ii_override !== null && regime.ii_override !== undefined)
                   ? regime.ii_override : aliq.ii;
    const icms_pct = (regime.icms_ef !== null && regime.icms_ef !== undefined)
                   ? regime.icms_ef : 12;

    const baseParams = {
      cambio, frete_pct: 12, seguro_pct: 0.5,
      ii_pct, ipi_pct: aliq.ipi, icms_pct, despesas_pct: 4,
    };

    let fob_usd = parseFloat(document.getElementById(prefix + '-fob').value) || 0;

    if (fob_usd > 0) {
      const imp   = calcImport({ ...baseParams, fobUSD: fob_usd });
      const shelf = imp.landed * (1 + markup_ret);
      return { fob_usd, imp, shelf, markup_ret, regime };
    } else {
      // Reverse from shelf price
      const shelf_price = parseFloat(document.getElementById(prefix + '-preco').value) || 0;
      if (!shelf_price) return null;
      const landed = shelf_price / (1 + markup_ret);

      function landedFromCIF(cif) {
        const ii = cif*(ii_pct/100), ipi = (cif+ii)*(aliq.ipi/100);
        const pis = cif*(PIS_IMP/100), cofins = cif*(COFINS_IMP/100);
        const desp = cif*0.04, pre = cif+ii+ipi+pis+cofins+desp;
        return pre + (icms_pct > 0 ? pre*(icms_pct/100)/(1-icms_pct/100) : 0);
      }
      let lo=0, hi=landed*3;
      for (let i=0; i<60; i++) { const mid=(lo+hi)/2; if(landedFromCIF(mid)<landed) lo=mid; else hi=mid; }
      const cif_est = (lo+hi)/2;
      fob_usd = (cif_est / (1.12 * 1.005)) / cambio;
      const imp = calcImport({ ...baseParams, fobUSD: fob_usd });
      return { fob_usd, imp, shelf: imp.landed * (1 + markup_ret), markup_ret, regime };
    }
  }

  const cm   = calcProduct('c-cm');
  const conc = calcProduct('c-conc');
  if (!cm || !conc) { alert('Configure os dois produtos antes de comparar.'); return; }

  const res = document.getElementById('comp-result');
  res.style.display = 'block';

  const cmNome   = document.getElementById('c-cm-nome').value;
  const concNome = document.getElementById('c-conc-nome').value;

  const diffPct = (a, b) => b > 0 ? ((a - b) / b * 100) : 0;
  const sign = v => v >= 0 ? '+' : '';
  const cls  = v => v >= 0 ? 'positive' : 'negative';

  const rows = [
    ['FOB (USD)',            cm.fob_usd,           conc.fob_usd,          fmtUSD],
    ['FOB (BRL)',            cm.imp.fob_brl,        conc.imp.fob_brl,      fmtBRL],
    ['Frete + Seguro',       cm.imp.cif-cm.imp.fob_brl, conc.imp.cif-conc.imp.fob_brl, fmtBRL],
    ['CIF',                  cm.imp.cif,            conc.imp.cif,          fmtBRL],
    ['II',                   cm.imp.ii,             conc.imp.ii,           fmtBRL],
    ['PIS + COFINS',         cm.imp.pis+cm.imp.cofins, conc.imp.pis+conc.imp.cofins, fmtBRL],
    ['ICMS',                 cm.imp.icms,           conc.imp.icms,         fmtBRL],
    ['Despesas',             cm.imp.despesas,       conc.imp.despesas,     fmtBRL],
    ['LANDED COST',          cm.imp.landed,         conc.imp.landed,       fmtBRL],
    ['Markup Varejista',     cm.imp.landed*(cm.markup_ret), conc.imp.landed*(conc.markup_ret), fmtBRL],
    ['PRE√áO PRATELEIRA',     cm.shelf,              conc.shelf,            fmtBRL],
  ];

  let html = `
    <div style="display:flex;gap:0;margin-bottom:8px;border-bottom:1px solid var(--border)">
      <div style="width:34%;font-size:11px;font-weight:600;color:var(--text-muted);text-transform:uppercase;padding:8px 10px">M√©trica</div>
      <div style="width:22%;text-align:right;padding:8px 10px;font-size:12px;font-weight:700;color:var(--orange)">${cmNome}<br><span style="font-size:10px;opacity:0.7">${cm.regime.label}</span></div>
      <div style="width:22%;text-align:right;padding:8px 10px;font-size:12px;font-weight:700;color:var(--text-secondary)">${concNome}<br><span style="font-size:10px;opacity:0.7">${conc.regime.label}</span></div>
      <div style="width:22%;text-align:right;padding:8px 10px;font-size:12px;font-weight:700;color:var(--yellow)">Œî (CM vs Conc)</div>
    </div>`;

  rows.forEach(([label, cmVal, concVal, fmt]) => {
    const diff = cmVal - concVal;
    const dp   = diffPct(cmVal, concVal);
    const isLast = label === 'PRE√áO PRATELEIRA';
    const rowBg = isLast ? 'background:rgba(240,136,62,0.08);border-top:1px solid var(--border);' : '';
    const fwt   = isLast ? 'font-weight:700;' : '';
    html += `<div style="display:flex;gap:0;${rowBg}border-bottom:1px solid rgba(255,255,255,0.04)">
      <div style="width:34%;padding:7px 10px;font-size:12px;color:var(--text-secondary);${fwt}">${label}</div>
      <div style="width:22%;text-align:right;padding:7px 10px;font-size:12px;color:var(--orange);${fwt}">${fmt(cmVal)}</div>
      <div style="width:22%;text-align:right;padding:7px 10px;font-size:12px;color:var(--text-secondary);${fwt}">${fmt(concVal)}</div>
      <div style="width:22%;text-align:right;padding:7px 10px;font-size:12px;${fwt}" class="${cls(diff*-1)}">
        ${sign(diff)}${fmt(diff)} (${sign(dp)}${dp.toFixed(1)}%)
      </div>
    </div>`;
  });

  const fobDiff = cm.fob_usd - conc.fob_usd;
  html += `<div class="note" style="margin-top:12px">
    <strong>üîç Insight:</strong>
    FOB CM ${fobDiff >= 0 ? 'maior' : 'menor'} em <strong>${fmtUSD(Math.abs(fobDiff))}</strong> vs concorrente.
    Pre√ßo prateleira CM: <strong>${fmtBRL(cm.shelf)}</strong> vs <strong>${fmtBRL(conc.shelf)}</strong>.
    Diferen√ßa final: <strong>${fmtBRL(Math.abs(cm.shelf - conc.shelf))}</strong>
    (${diffPct(cm.shelf, conc.shelf).toFixed(1)}%).
    ${cm.shelf > conc.shelf
      ? '‚ö†Ô∏è CM est√° mais caro ‚Äî considere rever o FOB ou garantir que o regime fiscal aplicado est√° correto.'
      : '‚úÖ CM est√° mais competitivo no pre√ßo final.'}
    <br><span style="opacity:0.7">Nota: regimes fiscais diferentes entre as marcas impactam diretamente o landed cost e o pre√ßo final ‚Äî verifique o regime correto de cada importador.</span>
  </div>`;

  document.getElementById('comp-result-body').innerHTML = html;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AJUSTES UI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildAjustesUI() {
  // Al√≠quotas editor
  const aliqEl = document.getElementById('aliquotas-editor');
  if (aliqEl && !aliqEl.hasChildNodes()) {
    let html = '';
    for (const [key, cat] of Object.entries(CATEGORIAS)) {
      html += `<div class="divider"></div>
        <div style="font-size:12px;font-weight:700;color:var(--text-primary);margin-bottom:8px">
          ${cat.label} <span class="ncm-badge">${cat.ncm}</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:4px">
          <div class="field">
            <label>II padr√£o (%) <span style="color:var(--text-muted);font-weight:400">‚Äî FUNDAP sobrep√µe para 0%</span></label>
            <input type="number" id="aliq-${key}-ii" value="${ALIQ[key].ii}" step="0.5" min="0" max="50"
              oninput="ALIQ['${key}'].ii=parseFloat(this.value)||0">
          </div>
          <div class="field">
            <label>IPI (%)</label>
            <input type="number" id="aliq-${key}-ipi" value="${ALIQ[key].ipi}" step="0.5" min="0" max="50"
              oninput="ALIQ['${key}'].ipi=parseFloat(this.value)||0">
          </div>
        </div>
        <div style="font-size:11px;color:var(--text-muted);margin-bottom:8px">
          PIS: <strong>2,10%</strong> | COFINS: <strong>9,65%</strong> ‚Äî al√≠quotas federais fixas (n√£o edit√°veis)
        </div>`;
    }
    aliqEl.innerHTML = html;
  }

  // Regimes info
  const regimesEl = document.getElementById('regimes-info');
  if (regimesEl && !regimesEl.hasChildNodes()) {
    let html = '';
    for (const [key, reg] of Object.entries(REGIMES)) {
      const ii_label  = reg.ii_override !== null && reg.ii_override !== undefined ? reg.ii_override + '% (fixo)' : 'per NCM/tabela';
      const icms_label = reg.icms_ef !== null && reg.icms_ef !== undefined ? reg.icms_ef + '%' : 'manual';
      html += `<div class="toggle-row">
        <div style="flex:1">
          <div style="font-size:12px;font-weight:700;color:var(--text-primary)">${reg.label}</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:2px">${reg.desc}</div>
          <div style="font-size:11px;color:var(--text-muted)">II: <strong>${ii_label}</strong> | ICMS: <strong>${icms_label}</strong></div>
        </div>
      </div>`;
    }
    html += `<div class="note" style="margin-top:8px">
      <strong>Clientes por regime:</strong><br>
      FUNDAP/ES: KaBuM<br>
      Normal/SP: Terabyte, VAIP, All Nations<br>
      TTD/SC: Pichau, Mazer, Oder√ßo
    </div>`;
    regimesEl.innerHTML = html;
  }
}

function syncCambio(val) {
  const v = parseFloat(val);
  if (!v) return;
  ['f-cambio','r-cambio'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = v;
  });
  const fc = document.getElementById('f-cambio-disp');
  const rc = document.getElementById('r-cambio-disp');
  if (fc) fc.textContent = v.toFixed(4);
  if (rc) rc.textContent = v.toFixed(4);
  document.getElementById('badge-cambio').textContent = 'USD/BRL ' + v.toFixed(4);
  calcForward();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VALIDA√á√ÉO HYPER 212
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function validarHyper212() {
  // Caso real confirmado pelo Country Manager:
  // FOB $9.00 ‚Üí Pre√ßo KaBuM R$78, Markup KaBuM 27%
  // Regime: FUNDAP/ES (II=0%, ICMS=0%)
  const cambio  = 5.2458;
  const fobUSD  = 9.00;
  const markup  = 0.27;

  const params = {
    fobUSD, cambio,
    frete_pct: 12, seguro_pct: 0.5,
    ii_pct: 0,   // FUNDAP
    ipi_pct: 0,  // coolers = 0
    icms_pct: 0, // FUNDAP
    despesas_pct: 4,
  };

  const imp    = calcImport(params);
  const shelf  = imp.landed * (1 + markup);
  const ok     = Math.abs(shelf - 78) < 2;
  const gp_eq  = (1 - 1/(1+markup)) * 100;

  const el = document.getElementById('validacao-resultado');
  el.innerHTML = `
    <div style="background:var(--bg-secondary);border-radius:8px;padding:12px;font-size:12px;line-height:2.1;border:1px solid ${ok ? 'var(--green)' : 'var(--red)'}">
      <div style="margin-bottom:8px;font-weight:700;color:${ok ? 'var(--green)' : 'var(--red)'}">
        ${ok ? '‚úÖ VALIDADO ‚Äî C√°lculo bate com a realidade!' : '‚ùå Diverg√™ncia detectada'}
      </div>
      <div><span style="color:var(--text-muted)">FOB USD:</span> <strong>$${fobUSD.toFixed(2)}</strong></div>
      <div><span style="color:var(--text-muted)">C√¢mbio:</span> <strong>R$ ${cambio}</strong></div>
      <div><span style="color:var(--text-muted)">FOB BRL:</span> <strong style="color:var(--blue)">${fmtBRL(imp.fob_brl)}</strong></div>
      <div><span style="color:var(--text-muted)">Frete (12%):</span> ${fmtBRL(imp.frete)}</div>
      <div><span style="color:var(--text-muted)">CIF (incl. seguro):</span> <strong>${fmtBRL(imp.cif)}</strong></div>
      <div style="border-top:1px solid var(--border);margin:4px 0;padding-top:4px">
        <span style="color:var(--text-muted)">II (FUNDAP: 0%):</span> <span style="color:var(--green)"><strong>R$ 0,00</strong> ‚úÖ (padr√£o seria R$${(imp.cif * 0.14).toFixed(2)})</span>
      </div>
      <div><span style="color:var(--text-muted)">IPI (cooler: 0%):</span> <span style="color:var(--green)">R$ 0,00 ‚úÖ</span></div>
      <div><span style="color:var(--text-muted)">PIS (2,10%):</span> <strong style="color:var(--red)">${fmtBRL(imp.pis)}</strong></div>
      <div><span style="color:var(--text-muted)">COFINS (9,65%):</span> <strong style="color:var(--red)">${fmtBRL(imp.cofins)}</strong></div>
      <div><span style="color:var(--text-muted)">ICMS (FUNDAP: 0%):</span> <span style="color:var(--green)"><strong>R$ 0,00</strong> ‚úÖ (padr√£o seria ~R$${(imp.cif * 0.12 / 0.88).toFixed(2)})</span></div>
      <div><span style="color:var(--text-muted)">Despesas (4% CIF):</span> ${fmtBRL(imp.despesas)}</div>
      <div style="border-top:1px solid var(--border);margin:4px 0;padding-top:4px">
        <span style="color:var(--text-muted)">LANDED COST:</span> <strong style="color:var(--yellow)">${fmtBRL(imp.landed)}</strong>
        <span style="color:var(--text-muted);font-size:11px"> (target: R$ 61,42)</span>
      </div>
      <div><span style="color:var(--text-muted)">Markup KaBuM (27% = markup, n√£o GP):</span> √ó${(1+markup).toFixed(2)}</div>
      <div><span style="color:var(--text-muted)">F√≥rmula:</span> Landed √ó 1,27 = Pre√ßo</div>
      <div style="margin-top:8px;font-size:15px">
        <strong style="color:var(--text-muted)">Pre√ßo calculado: </strong>
        <span style="color:${ok?'var(--green)':'var(--red)'};font-size:22px;font-weight:900">${fmtBRL(shelf)}</span>
        <span style="color:var(--text-muted);font-size:12px"> vs real: R$ 78,00 ${ok?'‚úÖ':'‚ùå'}</span>
      </div>
      <div style="margin-top:6px;font-size:11px;color:var(--text-muted)">
        Multiplicador FOB BRL‚ÜíVarejo: <strong>${(shelf/imp.fob_brl).toFixed(3)}x</strong>
        | Markup 27% ‚â° GP ${gp_eq.toFixed(1)}% sobre a receita
        | Tributa√ß√£o efetiva: PIS+COFINS+Desp apenas = ${fmtPct(pctOf(imp.pis+imp.cofins+imp.despesas, imp.landed))} do landed
      </div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
  // Initialize regime badges
  onRegimeChange('f');
  onRegimeChange('r');
  calcForward();
  calcReverse();
});
</script>

<!-- ‚ïê‚ïê HUB FOOTER ‚ïê‚ïê -->
<footer class="hub-footer">
  <a href="CM_Brasil_Hub.html">‚Üê Command Center</a>
  <span>CM Brasil Intelligence Platform ¬∑ Cooler Master</span>
</footer>
<!-- ‚ïê‚ïê END HUB FOOTER ‚ïê‚ïê -->

</body>
</html>
